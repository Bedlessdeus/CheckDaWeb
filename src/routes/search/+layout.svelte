<script lang="ts">
	import SearchBar from '$lib/client/component/input/SearchBar.svelte';
	import { cleanURL } from '$lib/client/util.js';

	let { data, children } = $props();

	let url = $derived(cleanURL(data.url));
	let normUrl = $derived(data.url);

	let favicon = $state(
		'data:image/png;base64,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'
	);

	const pullPushFavicon = async () => {
		let data = await fetch('/api/v1/favicon/gen?url=' + encodeURIComponent(url));
		favicon = URL.createObjectURL(await data.blob());
		console.log('Favicon updated:', favicon);
	};

	$effect(() => {
		pullPushFavicon();
	});
</script>

<div class="box flex flex-row items-center justify-between bg-primary-dark mb-8">
	<h1 class="pt-4 pl-4 text-center !text-6xl">
		<a href="/" class="!text-logo hover:!text-primary-cont">CheckDaWeb</a>
	</h1>
	<SearchBar url={normUrl} path="search" />
	<div class="flex flex-row">
		<img class="h-[64px] w-[64px] rounded-[10px]" alt="Nothing here" src={favicon} />
		<p class="h-full p-4 text-center text-[1.1rem]">{url}</p>
	</div>
</div>

{@render children()}
